#!/bin/bash
# Wrapper that silently drops notify-send calls from Voxtype.
# All other callers pass through to the real notify-send.
# Parses options positionally to avoid matching message body text.
prev=""
opts_done=false
for arg in "$@"; do
    if $opts_done; then
        prev=""
        continue
    fi
    if [[ "$arg" == "--" ]]; then
        opts_done=true
        continue
    fi
    # --app-name=VALUE or -aVALUE (combined short option)
    if [[ "$arg" == "--app-name=Voxtype" || "$arg" == "-aVoxtype" ]]; then
        exit 0
    fi
    # --app-name VALUE or -a VALUE (two-arg form)
    if [[ "$prev" == "--app-name" || "$prev" == "-a" ]] && [[ "$arg" == "Voxtype" ]]; then
        exit 0
    fi
    prev="$arg"
done
# Find the real notify-send by excluding the shim directory from PATH.
# Prefer /usr/bin if it exists, then fall back to PATH search.
shim_dir="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
real_notify=""
if [ -x /usr/bin/notify-send ]; then
    real_notify=/usr/bin/notify-send
else
    IFS=: read -ra dirs <<< "$PATH"
    for d in "${dirs[@]}"; do
        [ "$d" = "$shim_dir" ] && continue
        if [ -x "$d/notify-send" ]; then
            real_notify="$d/notify-send"
            break
        fi
    done
fi
if [ -n "$real_notify" ]; then
    exec "$real_notify" "$@"
fi
echo "notify-send-shim: could not find real notify-send in PATH" >&2
exit 127
